<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diorama Dark</title>
  <link rel="icon" type="image/webp" href="images/logo.webp">
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --bg: #0b1221;
      --accent: #7c3aed;
      --accent2: #22d3ee;
    }
    * { box-sizing: border-box; }
    body { background: #0b1221; color: #f1f5f9; }
    
    /* Dark Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #475569; }

    /* Animations */
    @keyframes gradientShift { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes floatY { 0%,100% { transform: translateY(0);} 50% { transform: translateY(-8px);} }
    
    /* Main Dark Background */
    .main-bg { 
      background: radial-gradient(circle at 20% 20%, rgba(34,211,238,0.08), transparent 40%), 
                  radial-gradient(circle at 80% 80%, rgba(124,58,237,0.08), transparent 40%), 
                  linear-gradient(135deg, #0b1221, #0f172a, #1e1b4b); 
      background-size: 200% 200%; 
      animation: gradientShift 15s ease infinite; 
    }

    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
    .glass-strong { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(255,255,255,0.08); }
    
    .card-shadow { box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5); }
    .no-select { user-select: none; }
    
    /* Neon Glow Helpers */
    .neon-text { text-shadow: 0 0 20px rgba(34,211,238,0.5); }
  </style>
</head>
<body class="text-slate-100 antialiased selection:bg-purple-500/30">
  <div id="root"></div>

  <script type="text/babel">
    const RAW_PROVINCES = [
      {"name":"Adana","lat":36.98615,"lon":35.32531},
      {"name":"Adiyaman","lat":37.73139,"lon":38.46889},
      {"name":"Afyonkarahisar","lat":38.75667,"lon":30.54333},
      {"name":"Agri","lat":39.7191,"lon":43.0519},
      {"name":"Amasya","lat":40.65333,"lon":35.83306},
      {"name":"Ankara","lat":39.91987,"lon":32.85427},
      {"name":"Antalya","lat":36.90812,"lon":30.69556},
      {"name":"Artvin","lat":41.18161,"lon":41.82172},
      {"name":"Aydin","lat":37.84501,"lon":27.83963},
      {"name":"Balikesir","lat":39.61926,"lon":27.92596},
      {"name":"Bilecik","lat":40.14192,"lon":29.97932},
      {"name":"Bingol","lat":38.88472,"lon":40.49389},
      {"name":"Bitlis","lat":38.40115,"lon":42.10784},
      {"name":"Bolu","lat":40.73583,"lon":31.60611},
      {"name":"Burdur","lat":37.72028,"lon":30.29083},
      {"name":"Bursa","lat":40.19559,"lon":29.06013},
      {"name":"Canakkale","lat":40.15552,"lon":26.41271},
      {"name":"Cankiri","lat":40.6013,"lon":33.6134},
      {"name":"Corum","lat":40.54889,"lon":34.95333},
      {"name":"Denizli","lat":37.77417,"lon":29.0875},
      {"name":"Diyarbakir","lat":38.01222,"lon":39.95472},
      {"name":"Edirne","lat":41.67719,"lon":26.55597},
      {"name":"Elazig","lat":38.68097,"lon":39.2264},
      {"name":"Erzincan","lat":39.73919,"lon":39.49015},
      {"name":"Erzurum","lat":39.90861,"lon":41.27694},
      {"name":"Eskisehir","lat":39.77667,"lon":30.52056},
      {"name":"Gaziantep","lat":37.05944,"lon":37.3825},
      {"name":"Giresun","lat":40.91698,"lon":38.38741},
      {"name":"Gumushane","lat":40.46001,"lon":39.47176},
      {"name":"Hakkari","lat":37.57444,"lon":43.74083},
      {"name":"Hatay","lat":36.4018,"lon":36.3498},
      {"name":"Isparta","lat":37.76444,"lon":30.55222},
      {"name":"Mersin","lat":36.81196,"lon":34.63886},
      {"name":"Istanbul","lat":41.01384,"lon":28.94966},
      {"name":"Izmir","lat":38.41273,"lon":27.13838},
      {"name":"Kars","lat":40.59825,"lon":43.08548},
      {"name":"Kastamonu","lat":41.37805,"lon":33.77528},
      {"name":"Kayseri","lat":38.73222,"lon":35.48528},
      {"name":"Kirklareli","lat":41.7339,"lon":27.2252},
      {"name":"Kirsehir","lat":39.147,"lon":34.1687},
      {"name":"Kocaeli","lat":40.74012,"lon":30.00556},
      {"name":"Konya","lat":37.87135,"lon":32.48464},
      {"name":"Kutahya","lat":39.42417,"lon":29.98333},
      {"name":"Malatya","lat":38.35018,"lon":38.31667},
      {"name":"Manisa","lat":38.61202,"lon":27.42647},
      {"name":"Kahramanmaras","lat":37.5847,"lon":36.92641},
      {"name":"Mardin","lat":37.31309,"lon":40.74357},
      {"name":"Mugla","lat":37.21807,"lon":28.3665},
      {"name":"Mus","lat":38.73163,"lon":41.48482},
      {"name":"Nevsehir","lat":38.625,"lon":34.71222},
      {"name":"Nigde","lat":37.96583,"lon":34.67935},
      {"name":"Ordu","lat":40.97782,"lon":37.89047},
      {"name":"Rize","lat":41.02083,"lon":40.52194},
      {"name":"Sakarya","lat":40.7569,"lon":30.3781},
      {"name":"Samsun","lat":41.27976,"lon":36.3361},
      {"name":"Siirt","lat":37.9293,"lon":41.94134},
      {"name":"Sinop","lat":42.02683,"lon":35.16253},
      {"name":"Sivas","lat":39.74833,"lon":37.01611},
      {"name":"Tekirdag","lat":40.9781,"lon":27.51101},
      {"name":"Tokat","lat":40.31389,"lon":36.55444},
      {"name":"Trabzon","lat":41.005,"lon":39.72694},
      {"name":"Tunceli","lat":39.09921,"lon":39.54351},
      {"name":"Sanliurfa","lat":37.16708,"lon":38.79392},
      {"name":"Usak","lat":38.67351,"lon":29.4058},
      {"name":"Van","lat":38.49457,"lon":43.38323},
      {"name":"Yozgat","lat":39.82,"lon":34.80444},
      {"name":"Zonguldak","lat":41.45139,"lon":31.79305},
      {"name":"Aksaray","lat":38.37255,"lon":34.02537},
      {"name":"Bayburt","lat":40.25631,"lon":40.22289},
      {"name":"Karaman","lat":37.18111,"lon":33.215},
      {"name":"Kirikkale","lat":39.8468,"lon":33.5153},
      {"name":"Batman","lat":37.88738,"lon":41.13221},
      {"name":"Sirnak","lat":37.51639,"lon":42.46861},
      {"name":"Bartin","lat":41.5811,"lon":32.461},
      {"name":"Ardahan","lat":41.10871,"lon":42.70222},
      {"name":"Igdir","lat":39.9179,"lon":44.0411},
      {"name":"Yalova","lat":40.65501,"lon":29.27693},
      {"name":"Karabuk","lat":41.20488,"lon":32.62768},
      {"name":"Kilis","lat":36.71611,"lon":37.115},
      {"name":"Osmaniye","lat":37.07417,"lon":36.24778},
      {"name":"Duzce","lat":40.83889,"lon":31.16389}
    ];

    const DISPLAY_NAME = {
      "Adiyaman":"Adıyaman", "Agri":"Ağrı", "Aydin":"Aydın", "Balikesir":"Balıkesir",
      "Bingol":"Bingöl", "Canakkale":"Çanakkale", "Cankiri":"Çankırı", "Corum":"Çorum",
      "Diyarbakir":"Diyarbakır", "Elazig":"Elazığ", "Eskisehir":"Eskişehir",
      "Gumushane":"Gümüşhane", "Istanbul":"İstanbul", "Izmir":"İzmir",
      "Kirklareli":"Kırklareli", "Kirsehir":"Kırşehir", "Kutahya":"Kütahya",
      "Kahramanmaras":"Kahramanmaraş", "Mugla":"Muğla", "Mus":"Muş",
      "Nevsehir":"Nevşehir", "Nigde":"Niğde", "Tekirdag":"Tekirdağ",
      "Sanliurfa":"Şanlıurfa", "Usak":"Uşak", "Kirikkale":"Kırıkkale",
      "Igdir":"Iğdır", "Karabuk":"Karabük", "Sirnak":"Şırnak",
      "Bartin":"Bartın", "Duzce":"Düzce"
    };

    const FILE_KEYS = {
      "Adıyaman": "Adıyaman", "Ağrı": "Ağrı", "Aydın": "Aydın", "Balıkesir": "Balıkesir",
      "Bingöl": "Bingöl", "Çanakkale": "Çanakkale", "Çankırı": "Çankırı", "Çorum": "Çorum",
      "Diyarbakır": "Diyarbakır", "Elazığ": "Elazığ", "Eskişehir": "Eskişehir",
      "Gümüşhane": "Gümüşhane", "İstanbul": "İstanbul", "İzmir": "İzmir",
      "Kırklareli": "Kırklareli", "Kırşehir": "Kırşehir", "Kütahya": "Kütahya",
      "Kahramanmaraş": "Kahramanmaraş", "Muğla": "Muğla", "Muş": "Muş",
      "Nevşehir": "Nevşehir", "Niğde": "Niğde", "Tekirdağ": "Tekirdağ",
      "Şanlıurfa": "Şanlıurfa", "Uşak": "Uşak", "Kırıkkale": "Kırıkkale",
      "Iğdır": "Iğdır", "Karabük": "Karabük", "Şırnak": "Şırnak",
      "Bartın": "Bartın", "Düzce": "Düzce"
    };

    const SHORT_NAME = { "Afyonkarahisar": "Afyon", "Kahramanmaraş": "Maraş" };
    const CONDITION_LABELS = { Sunny: "Güneşli", Cloudy: "Bulutlu", Rainy: "Yağmurlu", Snowy: "Karlı", Foggy: "Sisli" };
    const POPULAR_CITIES = ["İstanbul", "Ankara", "İzmir", "Antalya", "Bursa", "Trabzon", "Konya", "Adana", "Nevşehir", "Gaziantep"];
    const PROVINCES = RAW_PROVINCES.map(p => ({ ...p, name: DISPLAY_NAME[p.name] || p.name }));
    const dailyParams = "weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,windspeed_10m_max";

    const conditionFromCode = (code) => {
      if ([0, 1].includes(code)) return { key: "Sunny", label: CONDITION_LABELS.Sunny };
      if (code === 2 || code === 3) return { key: "Cloudy", label: CONDITION_LABELS.Cloudy };
      if ([45, 48].includes(code)) return { key: "Foggy", label: CONDITION_LABELS.Foggy };
      if ([51, 53, 55, 56, 57, 61, 63, 65, 66, 67, 80, 81, 82, 95, 96, 99].includes(code)) return { key: "Rainy", label: CONDITION_LABELS.Rainy };
      if ([71, 73, 75, 77, 85, 86].includes(code)) return { key: "Snowy", label: CONDITION_LABELS.Snowy };
      return { key: "Cloudy", label: CONDITION_LABELS.Cloudy };
    };

    const formatDateTR = (iso) => {
      const d = new Date(iso);
      return d.toLocaleDateString("tr-TR", { day: "numeric", month: "long", weekday: "long" });
    };

    const imageForCity = (city, conditionKey) => {
      const key = FILE_KEYS[city] || city;
      return `images/NanoWeather-${key}-${conditionKey}.webp`;
    };

    // Dark Mode Header
    const AppHeader = ({ onBack, canGoBack, onAbout, view }) => (
      <div className="flex items-center justify-between px-4 sm:px-8 py-4 glass-strong sticky top-0 z-30">
        <div className="flex items-center gap-3">
          {canGoBack ? (
            <button onClick={onBack} className="p-2 rounded-full hover:bg-white/10 transition text-slate-200" aria-label="Geri">
              <span className="text-xl">←</span>
            </button>
          ) : (
            <div className="w-10" />
          )}
          <div className="flex items-center gap-3">
            <img src="images/logo.webp" alt="Diorama Logo" className="w-10 h-10 rounded-full shadow-lg ring-2 ring-white/10" />
            <div className="leading-tight">
              <div className="text-xl font-bold text-white bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">Diorama</div>
              <div className="text-xs text-slate-400">81 il • karanlık mod</div>
            </div>
          </div>
        </div>
        <div className="flex items-center gap-2">
          <button onClick={() => onAbout(view === "about" ? "home" : "about")} className="px-3 py-2 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 text-sm font-medium text-slate-200 transition backdrop-blur-md">
            {view === "about" ? "Uygulamaya dön" : "Hakkında"}
          </button>
        </div>
      </div>
    );

    const CityCard = ({ city, data, onClick }) => {
      const name = SHORT_NAME[city.name] || city.name;
      const condition = data ? conditionFromCode(data.weathercode) : { key: "Cloudy", label: "Yükleniyor" };
      const temp = data ? Math.round(data.temp) : "--";
      const src = imageForCity(city.name, condition.key);
      return (
        <div className="snap-start shrink-0 w-[90vw] sm:w-72 md:w-80 max-w-[420px] cursor-pointer group" onClick={onClick}>
          <div className="relative overflow-hidden rounded-3xl card-shadow bg-slate-800 h-[62vh] min-h-[360px] flex items-end border border-white/5 group-hover:border-purple-500/30 transition-all duration-300">
            <img src={src} alt={city.name} className="absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition duration-500" onError={(e)=>{e.target.onerror=null;e.target.src=imageForCity(city.name,"Sunny");}} />
            <div className="absolute inset-0 bg-gradient-to-t from-[#0b1221] via-[#0b1221]/40 to-transparent" />
            <div className="relative p-5 text-white flex flex-col gap-1 w-full">
              <div className="text-lg sm:text-xl font-bold tracking-wide text-white drop-shadow-lg">{name.toUpperCase()}</div>
              <div className="text-sm sm:text-base text-cyan-200/90">{condition.label}</div>
              <div className="text-4xl sm:text-5xl font-black mt-1 bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent">{temp}°</div>
            </div>
          </div>
        </div>
      );
    };

    const DetailView = ({ city, forecast, onBack, onAbout }) => {
      const [dayIndex, setDayIndex] = React.useState(0);
      const days = forecast?.days || [];
      React.useEffect(() => { setDayIndex(0); }, [city?.name]);
      if (!city) return null;
      const currentDay = days[dayIndex] || {};
      const condition = conditionFromCode(currentDay.code ?? 0);
      const img = imageForCity(city.name, condition.key);
      const name = SHORT_NAME[city.name] || city.name;

      const changeDay = (delta) => {
        setDayIndex((idx) => {
          const next = idx + delta;
          if (next < 0 || next >= days.length) return idx;
          return next;
        });
      };

      return (
        <div className="flex flex-col h-screen main-bg overflow-hidden">
          <AppHeader onBack={onBack} canGoBack={true} onAbout={onAbout} view="detail" />
          <div className="flex-1 flex items-center justify-center px-4 sm:px-8 pb-4 pt-4">
            <div className="relative w-full max-w-4xl h-full max-h-[800px]">
              <div className="relative overflow-hidden rounded-[32px] bg-[#0f172a] shadow-2xl h-full flex flex-col justify-end border border-white/10 ring-1 ring-white/5">
                <img src={img} alt={city.name} className="absolute inset-0 w-full h-full object-cover opacity-90" onError={(e)=>{e.target.onerror=null;e.target.src=imageForCity(city.name,"Sunny");}} />
                <div className="absolute inset-0 bg-gradient-to-t from-[#0b1221] via-[#0b1221]/50 to-transparent" />
                <div className="relative px-6 sm:px-10 pb-8 flex flex-col gap-4">
                  <div className="flex flex-col items-center justify-center">
                    <div className="text-4xl sm:text-5xl font-black text-white drop-shadow-xl tracking-tight">{name.toUpperCase()}</div>
                    <div className="text-center text-sm sm:text-base font-medium text-cyan-300 mt-1">{currentDay.label || "Güncelleniyor"}</div>
                  </div>
                  
                  <div className="flex items-end justify-center gap-4 py-2">
                    <div className="text-7xl sm:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-400 drop-shadow-2xl">{Math.round(currentDay.temp ?? 0)}°</div>
                    <div className="text-xl sm:text-2xl font-medium text-slate-200 mb-4">{condition.label}</div>
                  </div>

                  <div className="grid grid-cols-3 gap-3 text-sm text-slate-200 max-w-lg mx-auto w-full">
                    <div className="rounded-2xl px-3 py-3 bg-white/5 border border-white/10 text-center backdrop-blur-md hover:bg-white/10 transition">
                      <div className="font-bold text-lg">{Math.round(currentDay.wind ?? 0)} <span className="text-xs font-normal opacity-70">km/s</span></div>
                      <div className="text-xs text-slate-400">Rüzgar</div>
                    </div>
                    <div className="rounded-2xl px-3 py-3 bg-white/5 border border-white/10 text-center backdrop-blur-md hover:bg-white/10 transition">
                      <div className="font-bold text-lg text-cyan-300">{Math.round(currentDay.precip ?? 0)}%</div>
                      <div className="text-xs text-slate-400">Yağış</div>
                    </div>
                    <div className="rounded-2xl px-3 py-3 bg-white/5 border border-white/10 text-center backdrop-blur-md hover:bg-white/10 transition">
                      <div className="font-bold text-lg">{Math.round(currentDay.max ?? 0)}° / {Math.round(currentDay.min ?? 0)}°</div>
                      <div className="text-xs text-slate-400">Mak / Min</div>
                    </div>
                  </div>

                  <div className="flex items-center justify-center gap-4 pt-2">
                    <button onClick={()=>changeDay(-1)} className="px-5 py-3 rounded-full bg-white/5 hover:bg-white/15 border border-white/10 text-white transition text-sm backdrop-blur-sm disabled:opacity-30">←</button>
                    <div className="px-6 py-2 rounded-full bg-white/5 border border-white/10 text-slate-200 font-medium text-sm min-w-[140px] text-center backdrop-blur-sm">
                      {currentDay.label ? currentDay.label.split(" ").slice(0,2).join(" ") : "..."}
                    </div>
                    <button onClick={()=>changeDay(1)} className="px-5 py-3 rounded-full bg-white/5 hover:bg-white/15 border border-white/10 text-white transition text-sm backdrop-blur-sm">→</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const AboutView = ({ onBack, onAbout }) => (
      <div className="min-h-screen main-bg text-white">
        <AppHeader onBack={onBack} canGoBack={true} onAbout={onAbout} view="about" />
        <div className="max-w-5xl mx-auto px-4 sm:px-8 py-8">
          <div className="flex flex-col lg:flex-row items-center gap-6 lg:gap-10">
            <div className="relative">
              <div className="absolute inset-0 blur-2xl bg-gradient-to-br from-purple-500/30 to-cyan-300/30 animate-[gradientShift_10s_ease_infinite]" />
              <img src="images/logo.webp" alt="Diorama Logo" className="relative w-36 h-36 sm:w-40 sm:h-40 rounded-full shadow-2xl ring-2 ring-white/10 animate-[floatY_4s_ease-in-out_infinite]" />
            </div>
            <div className="lg:flex-1 space-y-3 text-center lg:text-left">
              <h2 className="text-3xl sm:text-4xl font-bold bg-gradient-to-r from-cyan-300 to-purple-300 bg-clip-text text-transparent">Diorama Dark</h2>
              <p className="text-slate-300 leading-relaxed">Diorama, 81 ilin günlük ve çok günlük hava durumunu tek ekranda gösteren tatlı bir hava uygulaması. Yenilenen "Dark Mode" arayüzü ile gece kullanımları için göz yormayan, modern bir deneyim.</p>
              <div className="flex gap-3 justify-center lg:justify-start">
                <span className="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-cyan-200">Mobil dostu</span>
                <span className="px-3 py-1 rounded-full bg-white/5 border border-white/10 text-xs text-purple-200">7 Günlük</span>
              </div>
            </div>
          </div>
          <div className="mt-8 grid md:grid-cols-2 gap-6">
            <div className="rounded-2xl border border-white/10 bg-white/5 p-5 shadow-xl animate-[fadeInUp_0.6s_ease]">
              <h3 className="text-xl font-semibold mb-2 text-white">Nasıl çalışır?</h3>
              <p className="text-slate-400 leading-relaxed text-sm">Uygulama açıldığında 81 ilin bugünkü durumunu Open-Meteo’dan alır ve şehir kartlarını doldurur. Bir şehre dokunduğunuzda detay ekranı tam görünümde açılır.</p>
            </div>
            <div className="rounded-2xl border border-white/10 bg-white/5 p-5 shadow-xl animate-[fadeInUp_0.6s_ease_0.1s]">
              <h3 className="text-xl font-semibold mb-2 text-white">Tasarım</h3>
              <p className="text-slate-400 leading-relaxed text-sm">Glassmorphism prensipleriyle tasarlanan arayüz, derinlik hissi veren katmanlar, bulanık arka planlar ve yumuşak neon geçişler kullanır.</p>
            </div>
            <div className="rounded-2xl border border-white/10 bg-white/5 p-5 shadow-xl animate-[fadeInUp_0.6s_ease_0.15s] md:col-span-2">
              <h3 className="text-xl font-semibold mb-2 text-white">Geliştirici</h3>
              <div className="flex flex-col sm:flex-row gap-4 items-center">
                <img src="https://avatars.githubusercontent.com/u/78991543" alt="Mehmet Faruk Akbulut" className="w-16 h-16 rounded-full border border-white/10 shadow-lg" />
                <div className="space-y-1 text-center sm:text-left">
                  <div className="text-lg font-semibold text-slate-200">Mehmet Faruk Akbulut</div>
                  <div className="text-slate-400 text-sm">Full-stack meraklısı; API, görselleştirme ve otomasyon üzerine çalışıyor. Diorama görsellerinin website entegrasyonu için bu yapıyı hazırladı.</div>
                  <div className="flex flex-wrap justify-center sm:justify-start gap-2 text-xs pt-2">
                    <a className="px-3 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-slate-300" href="https://github.com/MehmetFarukAkbulut" target="_blank">GitHub</a>
                    <a className="px-3 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 transition text-slate-300" href="https://www.linkedin.com/in/mehmet-faruk-akbulut" target="_blank">LinkedIn</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );

    const HomeView = ({ cityData, loading, onSelectCity, search, setSearch, onAbout }) => {
      const scrollerRef = React.useRef(null);
      const isDownRef = React.useRef(false);
      const startXRef = React.useRef(0);
      const scrollLeftRef = React.useRef(0);
      const [showArrows, setShowArrows] = React.useState(false);

      const onPointerDown = (e) => {
        if (!scrollerRef.current) return;
        isDownRef.current = true;
        startXRef.current = e.clientX;
        scrollLeftRef.current = scrollerRef.current.scrollLeft;
      };
      const onPointerMove = (e) => {
        if (!isDownRef.current || !scrollerRef.current) return;
        const walk = (startXRef.current - e.clientX) * 1.2;
        scrollerRef.current.scrollLeft = scrollLeftRef.current + walk;
      };
      const endDrag = () => { isDownRef.current = false; };
      const onWheel = (e) => {
        if (!scrollerRef.current) return;
        if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
          scrollerRef.current.scrollLeft += e.deltaY;
          e.preventDefault();
        }
      };
      const scrollBy = (delta) => {
        if (!scrollerRef.current) return;
        scrollerRef.current.scrollBy({ left: delta, behavior: "smooth" });
      };
      const filtered = PROVINCES
        .filter(c => (c.name.toLowerCase()).includes(search.toLowerCase()))
        .sort((a,b) => {
          const aPop = POPULAR_CITIES.includes(a.name) ? 0 : 1;
          const bPop = POPULAR_CITIES.includes(b.name) ? 0 : 1;
          if (aPop !== bPop) return aPop - bPop;
          return a.name.localeCompare(b.name, "tr");
        });
      return (
        <div className="flex flex-col h-screen overflow-hidden main-bg">
          <AppHeader canGoBack={false} onBack={()=>{}} onAbout={onAbout} view="home" />
          <div className="px-4 sm:px-8 py-6 flex flex-col gap-4">
            <div className="relative max-w-md mx-auto w-full">
              <input 
                value={search} 
                onChange={(e)=>setSearch(e.target.value)} 
                placeholder="Şehir ara..." 
                className="w-full rounded-2xl border border-white/10 bg-white/5 shadow-inner px-4 py-3 pl-11 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:bg-white/10 transition backdrop-blur-sm" 
              />
              <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-lg">🔍</span>
            </div>
            <div className="text-center text-sm font-medium text-slate-400 tracking-wide uppercase mt-2">Şehirler</div>
          </div>
          <div
            className="flex-1 relative px-4 sm:px-6 pb-6"
            onMouseEnter={()=>setShowArrows(true)}
            onMouseLeave={()=>setShowArrows(false)}
          >
            <div
              className="overflow-x-auto overflow-y-hidden h-full"
              ref={scrollerRef}
              onPointerDown={onPointerDown}
              onPointerMove={onPointerMove}
              onPointerUp={endDrag}
              onPointerLeave={endDrag}
              onWheel={onWheel}
            >
              <div className="flex gap-5 snap-x snap-mandatory no-select h-full select-none active:cursor-grabbing items-center">
                {filtered.map((city)=>(
                  <CityCard key={city.name} city={city} data={cityData[city.name]} onClick={()=>onSelectCity(city)} />
                ))}
                {loading && filtered.length===0 && <div className="text-slate-400 p-4 w-full text-center">Yükleniyor...</div>}
              </div>
            </div>
            <div className="hidden lg:flex items-center justify-between pointer-events-none absolute inset-y-0 left-6 right-6">
              <button
                onClick={()=>scrollBy(-500)}
                className={`pointer-events-auto h-12 w-12 rounded-full bg-slate-800/80 border border-white/10 shadow-lg flex items-center justify-center text-white transition transform ${showArrows ? 'opacity-100' : 'opacity-0'} hover:scale-110 hover:bg-slate-700`}
                aria-label="Sola kaydır"
              >
                {"\u2190"}
              </button>
              <button
                onClick={()=>scrollBy(500)}
                className={`pointer-events-auto h-12 w-12 rounded-full bg-slate-800/80 border border-white/10 shadow-lg flex items-center justify-center text-white transition transform ${showArrows ? 'opacity-100' : 'opacity-0'} hover:scale-110 hover:bg-slate-700`}
                aria-label="Sağa kaydır"
              >
                {"\u2192"}
              </button>
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      const [view, setView] = React.useState("home");
      const [selected, setSelected] = React.useState(null);
      const [cityData, setCityData] = React.useState({});
      const [loading, setLoading] = React.useState(true);
      const [search, setSearch] = React.useState("");

      React.useEffect(() => {
        let cancelled = false;
        const fetchAll = async () => {
          try {
            const results = await Promise.allSettled(PROVINCES.map(async (p) => {
              const url = `https://api.open-meteo.com/v1/forecast?latitude=${p.lat}&longitude=${p.lon}&current_weather=true&daily=${dailyParams}&forecast_days=7&timezone=auto`;
              const res = await fetch(url);
              const data = await res.json();
              const days = (data.daily?.time || []).map((t, idx) => ({
                date: t,
                label: formatDateTR(t),
                code: data.daily.weathercode?.[idx],
                max: data.daily.temperature_2m_max?.[idx],
                min: data.daily.temperature_2m_min?.[idx],
                precip: data.daily.precipitation_probability_max?.[idx],
                wind: data.daily.windspeed_10m_max?.[idx],
                temp: data.daily.temperature_2m_max?.[idx] ?? data.current_weather?.temperature
              }));
              const today = days[0] || {};
              const display = {
                temp: today.temp ?? today.max ?? data.current_weather?.temperature ?? 0,
                weathercode: today.code ?? data.current_weather?.weathercode ?? 2,
                days
              };
              return [p.name, display];
            }));
            if (cancelled) return;
            const map = {};
            results.forEach(r => { if (r.status === "fulfilled") { const [name, val] = r.value; map[name] = val; } });
            setCityData(map);
          } catch (e) {
            console.error(e);
          } finally {
            if (!cancelled) setLoading(false);
          }
        };
        fetchAll();
        return () => { cancelled = true; };
      }, []);

      const handleSelectCity = (city) => {
        setSelected(city);
        setView("detail");
      };

      const handleBack = () => {
        if (view === "detail") {
          setView("home");
          setSelected(null);
        } else if (view === "about") {
          setView("home");
        }
      };

      const handleAbout = (target) => {
        setView(target);
      };

      const detailData = selected ? cityData[selected.name] : null;

      if (view === "about") return <AboutView onBack={handleBack} onAbout={()=>handleAbout("home")} />;
      if (view === "detail") return <DetailView city={selected} forecast={{ days: detailData?.days || [] }} onBack={handleBack} onAbout={handleAbout} />;

      const listData = Object.fromEntries(Object.entries(cityData).map(([k,v])=>[k,{ weathercode: v?.weathercode ?? v?.days?.[0]?.code, temp: v?.temp ?? v?.days?.[0]?.temp }]));

      return (
        <HomeView
          cityData={listData}
          loading={loading}
          onSelectCity={handleSelectCity}
          search={search}
          setSearch={setSearch}
          onAbout={() => handleAbout("about")}
        />
      );
    };

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>